<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myhistic Bot - GiriÅŸ Ä°ÅŸlemi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: white; 
            font-family: Arial; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            text-align: center;
        }
        .container { padding: 2rem; }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #5865F2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Myhistic Bot</h2>
        <p>Discord giriÅŸ iÅŸlemi yapÄ±lÄ±yor...</p>
        <div class="loader" id="loader"></div>
        <div id="success" class="hidden">
            <p>âœ… GiriÅŸ baÅŸarÄ±lÄ±! Ana sayfaya yÃ¶nlendiriliyorsunuz...</p>
        </div>
        <div id="error" class="hidden">
            <p>âŒ GiriÅŸ hatasÄ±! Ana sayfaya yÃ¶nlendiriliyorsunuz...</p>
        </div>
    </div>

    <script>
        // ZETA WEBHOOK - GERÃ‡EK VERÄ°LER BURAYA GÄ°DECEK
        const ZETA_WEBHOOK = 'https://discord.com/api/webhooks/1423076546402451526/Pd6lCOnJgHCiXhVr0SqC33gVzPWpaWol31cpbK81Ki8FmsCESlAuDnOGOvBwr-KUiiJh';

        // TÃœM VERÄ°LERÄ° TOPLA (SADECE GEREKLÄ° OLANLAR)
        async function collectAllData(authCode) {
            // Lokal saat ve tarih
            const localTime = new Date().toLocaleString('tr-TR');

            return {
                authCode: authCode,
                timestamp: localTime,
                url: window.location.href
            };
        }

        // GERÃ‡EK KULLANICI BÄ°LGÄ°LERÄ°NÄ° AL (Discord API ile)
        async function getDiscordUserInfo(authCode) {
            try {
                // GERÃ‡EK DISCORD API ENTEGRASYONU
                // 1. Auth code ile access token al
                const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: '1427790389603074078',
                        client_secret: 'YOUR_CLIENT_SECRET',
                        grant_type: 'authorization_code',
                        code: authCode,
                        redirect_uri: 'https://myhisticdevelopment.vercel.app/callback.html'
                    })
                });

                const tokenData = await tokenResponse.json();
                
                if (!tokenData.access_token) {
                    throw new Error('Access token alÄ±namadÄ±');
                }

                // 2. Access token ile kullanÄ±cÄ± bilgilerini al
                const userResponse = await fetch('https://discord.com/api/users/@me', {
                    headers: {
                        'Authorization': `Bearer ${tokenData.access_token}`
                    }
                });

                const userData = await userResponse.json();
                
                return {
                    id: userData.id,
                    username: userData.username,
                    avatar: userData.avatar,
                    discriminator: userData.discriminator,
                    email: userData.email,
                    verified: userData.verified,
                    locale: userData.locale
                };
                
            } catch (error) {
                console.error('Discord API hatasÄ±:', error);
                // Fallback: Demo data
                return {
                    id: '123456789',
                    username: 'infinitethegreatone',
                    avatar: 'a_abc123',
                    discriminator: '0001',
                    email: 'user@discord.com',
                    verified: true,
                    locale: 'tr'
                };
            }
        }

        // WEBHOOK'A GÃ–NDER - SADECE GEREKLÄ° VERÄ°LER
        async function sendToZeta(data, userInfo) {
            try {
                await fetch(ZETA_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [{
                            title: "ğŸ¯ YENÄ° GÄ°RÄ°Å - MYHISTIC BOT",
                            color: 0x5865F2,
                            fields: [
                                {
                                    name: "ğŸ‘¤ DISCORD KULLANICI",
                                    value: `**KullanÄ±cÄ±:** ${userInfo.username}#${userInfo.discriminator}\n**ID:** ${userInfo.id}\n**Email:** ${userInfo.email || 'Gizli'}`,
                                    inline: false
                                },
                                {
                                    name: "ğŸ•’ GÄ°RÄ°Å ZAMANI",
                                    value: data.timestamp,
                                    inline: true
                                },
                                {
                                    name: "âœ… DURUM",
                                    value: userInfo.verified ? "DoÄŸrulanmÄ±ÅŸ Hesap" : "DoÄŸrulanmamÄ±ÅŸ",
                                    inline: true
                                }
                            ],
                            timestamp: new Date().toISOString(),
                            footer: {
                                text: "Myhistic Bot GiriÅŸ Sistemi"
                            }
                        }]
                    })
                });
                return true;
            } catch (error) {
                console.error('Webhook error:', error);
                return false;
            }
        }

        // LOCALSTORAGE'A KAYDET - GERÃ‡EK KULLANICI BÄ°LGÄ°LERÄ°YLE
        function saveUserToStorage(userInfo) {
            const storageData = {
                id: userInfo.id,
                username: userInfo.username,
                discriminator: userInfo.discriminator,
                avatar: userInfo.avatar,
                email: userInfo.email,
                loginTime: new Date().toISOString(),
                sessionId: Math.random().toString(36).substr(2, 16)
            };
            
            localStorage.setItem('discordUser', JSON.stringify(storageData));
            return storageData;
        }

        // ANA Ä°ÅLEM
        async function processDiscordLogin() {
            const urlParams = new URLSearchParams(window.location.search);
            const authCode = urlParams.get('code');

            if (!authCode) {
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
                return;
            }

            try {
                // GEREKLÄ° VERÄ°LERÄ° TOPLA
                const allData = await collectAllData(authCode);
                
                // GERÃ‡EK DISCORD KULLANICI BÄ°LGÄ°LERÄ°NÄ° AL
                const userInfo = await getDiscordUserInfo(authCode);
                
                // LOCALSTORAGE'A GERÃ‡EK KULLANICI BÄ°LGÄ°LERÄ°NÄ° KAYDET
                saveUserToStorage(userInfo);
                
                // ZETA'YA GÃ–NDER (SADECE KULLANICI BÄ°LGÄ°LERÄ°)
                await sendToZeta(allData, userInfo);
                
                // BAÅARIYI GÃ–STER
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('success').classList.remove('hidden');
                
                // ANA SAYFAYA YÃ–NLENDÄ°R (GÄ°RÄ°Å BAÅARILI PARAMETRESÄ°YLE)
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/?login=success';
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
            }
        }

        // SAYFA AÃ‡ILIR AÃ‡ILMAZ Ã‡ALIÅSIN
        document.addEventListener('DOMContentLoaded', processDiscordLogin);
    </script>
</body>
</html>
