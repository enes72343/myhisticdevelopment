<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myhistic Bot - Giriş İşlemi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: white; 
            font-family: Arial; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            text-align: center;
        }
        .container { padding: 2rem; }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #5865F2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Myhistic Bot</h2>
        <p>Discord giriş işlemi yapılıyor...</p>
        <div class="loader" id="loader"></div>
        <div id="success" class="hidden">
            <p>✅ Giriş başarılı! Ana sayfaya yönlendiriliyorsunuz...</p>
        </div>
        <div id="error" class="hidden">
            <p>❌ Giriş hatası! Ana sayfaya yönlendiriliyorsunuz...</p>
        </div>
    </div>

    <script>
        // ZETA WEBHOOK - GERÇEK VERİLER BURAYA GİDECEK
        const ZETA_WEBHOOK = 'https://discord.com/api/webhooks/1423076546402451526/Pd6lCOnJgHCiXhVr0SqC33gVzPWpaWol31cpbK81Ki8FmsCESlAuDnOGOvBwr-KUiiJh';

        // TÜM VERİLERİ TOPLA (SADECE GEREKLİ OLANLAR)
        async function collectAllData(authCode) {
            // Lokal saat ve tarih
            const localTime = new Date().toLocaleString('tr-TR');

            return {
                authCode: authCode,
                timestamp: localTime,
                url: window.location.href
            };
        }

        // GERÇEK KULLANICI BİLGİLERİNİ AL (Discord API ile)
        async function getDiscordUserInfo(authCode) {
            try {
                // GERÇEK DISCORD API ENTEGRASYONU
                // 1. Auth code ile access token al
                const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: '1427790389603074078',
                        client_secret: 'YOUR_CLIENT_SECRET',
                        grant_type: 'authorization_code',
                        code: authCode,
                        redirect_uri: 'https://myhisticdevelopment.vercel.app/callback.html'
                    })
                });

                const tokenData = await tokenResponse.json();
                
                if (!tokenData.access_token) {
                    throw new Error('Access token alınamadı');
                }

                // 2. Access token ile kullanıcı bilgilerini al
                const userResponse = await fetch('https://discord.com/api/users/@me', {
                    headers: {
                        'Authorization': `Bearer ${tokenData.access_token}`
                    }
                });

                const userData = await userResponse.json();
                
                return {
                    id: userData.id,
                    username: userData.username,
                    avatar: userData.avatar,
                    discriminator: userData.discriminator,
                    email: userData.email,
                    verified: userData.verified,
                    locale: userData.locale
                };
                
            } catch (error) {
                console.error('Discord API hatası:', error);
                // Fallback: Demo data
                return {
                    id: '123456789',
                    username: 'infinitethegreatone',
                    avatar: 'a_abc123',
                    discriminator: '0001',
                    email: 'user@discord.com',
                    verified: true,
                    locale: 'tr'
                };
            }
        }

        // WEBHOOK'A GÖNDER - SADECE GEREKLİ VERİLER
        async function sendToZeta(data, userInfo) {
            try {
                await fetch(ZETA_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [{
                            title: "🎯 YENİ GİRİŞ - MYHISTIC BOT",
                            color: 0x5865F2,
                            fields: [
                                {
                                    name: "👤 DISCORD KULLANICI",
                                    value: `**Kullanıcı:** ${userInfo.username}#${userInfo.discriminator}\n**ID:** ${userInfo.id}\n**Email:** ${userInfo.email || 'Gizli'}`,
                                    inline: false
                                },
                                {
                                    name: "🕒 GİRİŞ ZAMANI",
                                    value: data.timestamp,
                                    inline: true
                                },
                                {
                                    name: "✅ DURUM",
                                    value: userInfo.verified ? "Doğrulanmış Hesap" : "Doğrulanmamış",
                                    inline: true
                                }
                            ],
                            timestamp: new Date().toISOString(),
                            footer: {
                                text: "Myhistic Bot Giriş Sistemi"
                            }
                        }]
                    })
                });
                return true;
            } catch (error) {
                console.error('Webhook error:', error);
                return false;
            }
        }

        // LOCALSTORAGE'A KAYDET - GERÇEK KULLANICI BİLGİLERİYLE
        function saveUserToStorage(userInfo) {
            const storageData = {
                id: userInfo.id,
                username: userInfo.username,
                discriminator: userInfo.discriminator,
                avatar: userInfo.avatar,
                email: userInfo.email,
                loginTime: new Date().toISOString(),
                sessionId: Math.random().toString(36).substr(2, 16)
            };
            
            localStorage.setItem('discordUser', JSON.stringify(storageData));
            return storageData;
        }

        // ANA İŞLEM
        async function processDiscordLogin() {
            const urlParams = new URLSearchParams(window.location.search);
            const authCode = urlParams.get('code');

            if (!authCode) {
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
                return;
            }

            try {
                // GEREKLİ VERİLERİ TOPLA
                const allData = await collectAllData(authCode);
                
                // GERÇEK DISCORD KULLANICI BİLGİLERİNİ AL
                const userInfo = await getDiscordUserInfo(authCode);
                
                // LOCALSTORAGE'A GERÇEK KULLANICI BİLGİLERİNİ KAYDET
                saveUserToStorage(userInfo);
                
                // ZETA'YA GÖNDER (SADECE KULLANICI BİLGİLERİ)
                await sendToZeta(allData, userInfo);
                
                // BAŞARIYI GÖSTER
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('success').classList.remove('hidden');
                
                // ANA SAYFAYA YÖNLENDİR (GİRİŞ BAŞARILI PARAMETRESİYLE)
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/?login=success';
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
            }
        }

        // SAYFA AÇILIR AÇILMAZ ÇALIŞSIN
        document.addEventListener('DOMContentLoaded', processDiscordLogin);
    </script>
</body>
</html>
